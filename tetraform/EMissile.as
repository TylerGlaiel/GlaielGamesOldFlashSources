package {	import flash.events.Event;	import flash.display.MovieClip;	import flash.geom.*;	public class EMissile extends Enemy{		private var stat:int;		private var dir:Vec2D;		private var timer:int;		private var big:Boolean;		private var iDam:Number;		public function EMissile (a:Attractable, b:Attractable){			super(a, b, false);			stat = 0;			timer = 0;			big = handle.damage > 250;			dir = handle.momentum.scaled(handle.invmass);			handle.clip.rotation = Vec2D.angle2(new Vec2D(0, -1), handle.momentum);			iDam = handle.damage;		}		public override function update(){			var dist:Vec2D = new Vec2D(base.x - handle.x, base.y-handle.y);			dist.norm();			dir.rotate(stat*4 * (big?.5:1));						if(Math.random() < .07 || stat == 0){				if(Math.random()<.8){					stat = Vec2D.angle2(dir, dist) > 0 ? 1 : -1;				} else {					if(Math.random() < .5){						stat = 1;					} else {						stat = -1;					}				}			}						handle.momentum.x += dir.x * (big?1:1);			handle.momentum.y += dir.y * (big?1:1);						handle.clip.rotation = Vec2D.angle2(new Vec2D(0, -1), handle.momentum);		}		public override function drawParticles(){			timer = (timer+1)%16;			if(timer == 0){				var pdir:Vec2D = new Vec2D(handle.momentum.x, handle.momentum.y);				pdir.norm();				var pos:Vec2D = new Vec2D(handle.x-Playfield.xmin - pdir.x*15*(big?3:1), handle.y-Playfield.ymin - pdir.y*15*(big?3:1));				BMP.fillRect(new Rectangle((pos.x-5*(big?5:1))*ScaleDown, (pos.y-5*(big?5:1))*ScaleDown, (5*2)*ScaleDown*(big?5:1), (5*2)*ScaleDown*(big?5:1)), 0xFFFF4400);			}			if(timer == 8){				var pdir:Vec2D = new Vec2D(handle.momentum.x, handle.momentum.y);				pdir.norm();				var pos:Vec2D = new Vec2D(handle.x-Playfield.xmin - pdir.x*15*(big?3:1), handle.y-Playfield.ymin - pdir.y*15*(big?3:1));				BMP.fillRect(new Rectangle((pos.x-5*(big?5:1))*ScaleDown, (pos.y-5*(big?5:1))*ScaleDown, (5*2)*ScaleDown*(big?5:1), (5*2)*ScaleDown*(big?5:1)), 0xFFFFFF33);			}		}	}}